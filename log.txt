This is a log file for documenting changes to AraSim.
Enter the date, your name, and comments about the changes you have made.
8/25/10	Connolly   Committed first version to be released to RadioSim group, tagged Release_Connolly_082510.  This version compiles and runs without errors but does not actually calculate anything.

9/8/11 E. Hong  Modified few files to work compiling on ubuntu. Below are modified things

EarthModel.cc : as there are no "Signal.h" file, copied signal.hh and signal.cc files from icemc and added.
EarthModel.cc : changed #include "earthmodel.hh" to "EarthModel.h"
EarthModel.cc : changed #include "icemodel.hh" to "IceModel.h"
EarthModel.cc : changed #include "vector.hh" to "Vector.h"
EarthModel.cc : changed #include "position.hh" to "Position.h"
EarthModel.cc : added #include <cstdlib>

Tools.cc : changed #include <fstream.h> to <fstream>

signal.cc : changed #include "vector.hh" to "Vector.h"
signal.cc : changed #include "position.hh" to "Position.h"

Added Settings.h and Settings.cc for set variables and initialize them.

AraSim.cc : added #include "Settings.h"
AraSim.cc : modified variable settings. Now Settings class will define and read variables from file.
AraSim.cc : print variable values to check initialize works fine and read file works fine.

Added setup.txt file to set variable vales. For more detail, read setup.txt file.

Makefile : added Settings.cc to CCFILE
Makefile : changed CCFILE -> Signal.cc to signal.cc


9/16/11 E. Hong; Modified Detector.cc, Detector.h, AraSim.cc.

Detector class : removed original parts
                 defined 3 different modes for Detector class.
                 mode 0 : use testbed antenna infomation
                 mode 1 : small number of stations (1 ~ 7). Array increase as pentagon shape
                 mode 2 : pentagon shape station arrays.

Above, in mode 1 and 2, each station will contain 4 strings and 4 surface antennas. The map of single station is shown in "ARADetailMap.pdf" file.
We can change the distance between center of station and strings (R_string),
Distance between center of station and surface antennas (R_surf),
Maximum depth of string (z_max), distance between antennas on the string (z_btw), etc.

Also, we can change the center of pentagon array (core_x, core_y),
distance between stations (station_spacing)

In mode 1 : total number of stations (number_of_stations)
            
In mode 2 : number of stations on the side (stations_per_side)

More detail will be shown on AraSim_doc.pdf file.


9/19/11 E. Hong; Modified AraSim.cc, added testbed_info.txt file.

AraSim.cc : added one more plot in pdf file output. Added plot is for borehole antenna layout.
testbed_info.txt : file added. This file should have added in previous version.
AraSim_doc.pdf : fixed some typos.


10/11/11 E. Hong; Modified Detector.cc, Detector.h, Settings.cc, Settings.h, AraSim.cc, added flux models for Spectra class.

Detector class : added reading nec2 antenna property (gain). Currently V-pol (6in bicone) and H-pol (23in QSC) borehole antennas' gain are available. Read by GetGain or GetG function.

Settings class : added DETECTOR parameter which decide the mode of detector layout.

Spectra class : copied from icemc. Information on README_EXPONENT and fluxes/README.

More detail, see AraSim_doc.pdf file.

=============================================================================

11/03/11 E. Hong; Two main things!.

1) added PickUnbiased function in IceModel class (copy from icemc).
    PickUnbiased function can pick any random unbiased posnu (interaction point of neutrino inside the antarctic ice) and nnu (direction of neutrino propagation).

2) outputs/AraOut.root has detector class as a branch.
    For this, class Detector (including ARA_station, Antenna_string, Antenna, Surface_antenna, Parameters classes) added to ROOT class. Method is shown in http://www.phys.ufl.edu/LIGO/wavelet/root_shared_lib.html
    Also sub-classes of Detector (Vector and Position) are added to ROOT class with same method.
    Parameters class in Detector -> some values (static const) changed to int or double.
    GetGain function in Detector -> use freq_step, ang_step, freq_width, freq_init in Detector instead of same values in Parameters class (it causes returning wrong vales... and I don't understand why)


3) some other minor changes : 
    Ray class : added WhereDoesItLeave function from icemc ray class
    EarthModel class : added TRandom3.h header file
    counting class : add from icemc (need for Primaries class)
    Settings class : add many variable from icemc Settings class (need for Primaries class)


4) minor thing added: added Makefile.org, M.readTree and readTree.cc file.
    after compile AraSim and run arasim (which produces outputs/AraOut.root file), we can use compile readTree.cc and test if we can read outputs/AraOut.root file correctly.
    method I did : cp M.readTree Makefile
                    make clean all
                    make clean readTree
                    ./readTree
    way to comeback AraSim compile:
                    cp Makefile.org Makefile
                    make clean all
                    make clean araSim
                    ./araSim

===============================================================================

11/08/11 E. Hong; add more classed for ROOT. (IceModel, EarthModel, Interaction, Spectra, Settings)

1) Primaries : added variable int pickunbiased to store IceModel::PickUnbiased return value.

2) making plots codes move from AraSim.cc to readTree.cc

3) some other minor changes...

===============================================================================

11/09/11 E. Hong; fixed ray_solver_makefile

Simply removed two lines and added Makefile.arch.
It fixed compiling bug in my (Ubuntu) machine.

Also added README_ray_solver for simple instruction.

===============================================================================

12/21/11 E. Hong;

Main changes : added fortran codes for time domain Askaryan radiation simulation (this is not complete as we still need more codes from Jaime)

    use signal, secondaries files from icemc for frequency domain ray simulation.

Without any changes of setup.txt and ARA_N_info.txt files, AraSim will run frequency domain simulation with 60 frequency bin (same with antenna frequency domain), only one ARA station, only 10 neutrino events.

Currently AraSim will printout detailed informations about ray signal (V/m/MHz @1m for every freq bin, all antennas) so, you better make them written in log file such as

./araSim > log_file

AraSim doesn't save V/m/MHz information in output root file yet.
However, it only needs to add parts to apply 1/r, ice attenuation factor and other antenna responses.


setup.txt -> SIMULATION_MODE    0 for freq domain, 1 for time domain simulation

setup.txt -> INTERACTION_MODE   0 : use PickUnbiased (randomly choose position of interaction inside all Antarctic ice)
                                1 : use PickNear (randomly choose position of interaction near by stations)

setup.txt -> POSNU_RADIUS       2000 : for PickNear, boundary radius for position of interaction defualt 2000m

===============================================================================

12/22/11 E. Hong;

Forgot to mention that from this version, you need g77 to compile fortran codes.
In Ubuntu, I did

Edit your /etc/apt/sources.list to add:
deb http://cz.archive.ubuntu.com/ubuntu hardy-updates main universe

Then use:
sudo apt-get update
sudo apt-get install g77

===============================================================================


01/23/12 E. Hong;

Temperary removed Fortran part. (confliction between different os systems and can't solve the problem yet)
Added Report class which designed to contain all valuable information about interaction and signal for each antennas.

Report has similar structure as Detector ( report->stations[i].strings[j].antennas[k] )
Each antenna has number of raysolver solutions (ray_sol_cnt),
     information about whether the antenna triggered for each raysolver solutions (trg[i])
    view angle for each raysolver solutions ( view_ang[i] )
    antenna receive angle for each raysolver solutions (rec_ang[i])
    travel distance between the source and the antenna for each raysolver solutions ( Dist[i] )
    signal V/m/MHz for each frequency bin (same freq bin with Detector antenna) for each raysolver solutions ( vmmhz[i][j] )

vmmhz in Report has 1/R and ice attenuation factor in it. (maybe need revision later)
ice attenuation factor is calculated by IceMocel -> EffectiveAttenuationLength (attenuation length depend on depth of ice)


Also removed all TGraph, TSpline classes in Spectra class which caused readTree segmentation violation.
Spectra class should be fixed later for better neutrino flux interpolation.

Makefile modified.
Removed Fortran code part, simplified by Paul Schellin

There are also some minor changes in IceModel, AraSim.cc, Detector.

Like previous version, running araSim will print out (cout) lots of information to trace bugs.
I highly recommend to run araSim with saving the outputs in log file such as

./araSim > log

After compiling AraSim and run correctly, it will create output root file at /outputs/AraOut.root
You can compile readTree.cc file and run it to make plots from AraOut.root file

make -f M.readTree

./readTree

For example, ARA-37_station_layout.pdf will show you the layout of ARA detector (as you set by setup.txt),
    GEdN.pdf will show you the EdNdEdAdt neutrino flux (as you set by setup.txt)

===============================================================================

01/23/12_2 E. Hong;

Some minor changes in Report class.

Variables in Report which are overlapping with Interaction class have been removed.
Report should more focus on connection between Interaction and Detector classes.


===============================================================================

01/25/12 E. Hong;

Main change : let Interaction as a vector inside Event class.
Event class has basic information about the event.
 ( choose the initial particle, flavor, direction, etc)
 There will be number of Interaction vector array as much as number of interactions
 (currently there is only 1 interaction)

Interaction class will have information about that specific interaction.
So, elast_y, posnu, emfrac, hadfrac, cone width, VmMHz1m will be determinded

Report class will then read Event class (then we can access Interaction of that Event), Detector class and some other classes which needed to calculate the signal at each antennas.

Some more modifications are expected after discusstion with Prof. Connolly.


===============================================================================

01/26/12 E. Hong;

There was a bug in the previous version that Report keep accumulate information as event goes on.
Added clear() function in the Antenna_r class in Report and call it when we use Connect_Interaction_Detector function.

Also modified readTree.cc to work in new structure of AraOut.root file.


===============================================================================

02/01/12 E. Hong;

Modified Report and IceModel classes.
Added GetFresnel function in IceModel. It is similar with GetFresnel in icemc.cc but values calculated in GetFresnel is changed from refracted ray to reflected ray as there are only reflected rays in ARA.

Also added GetParameters function in Report.
GetParameters will calculate the viewangle, launch vector and receive vector.

Minor change in Interaction class, PickNear function.
Fixed the bug that PickNear more likely pick posnu near the center of the array.

===============================================================================

02/10/12 E. Hong;

Fixed some bugs in IceModel->GetFresnel and Report.
At GetFresnel function, magnification factor was calculated wrong.
In Report, when ice attenuation factor is applied, there was extra factor 2 applied inside exponential (power <-> field)

===============================================================================

02/13/12 E. Hong;

Fixed bug in initialzation function in signal class.
Previously there was no initialization function for LPM in signal class.
Now added LPM in Settings class, and read the LPM value from Settings class and set LPM in signal class.


===============================================================================


